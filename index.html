<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Foreign workers in the USA</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
	  <style>
	  .bar {
	    fill: steelblue;
	  }
	  .bar:hover {
	    fill: brown;
	  }
	  .axis {
	    font: 9px sans-serif;
	  }
	  .axis path,
	  .axis line {
	    fill: none;
	    stroke: #000;
	    shape-rendering: crispEdges;
	  }
	  .x.axis path {
	    display: none;
	  }
	.chart rect {
	  fill: steelblue;
	}
	
	.chart text {
	  fill: white;
	  font: 10px sans-serif;
	  text-anchor: end;
	}
	
	.tick text {
		fill: black;
	}
	  </style>
	  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-64459548-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
	<body>
    <div class="wrapper">
      <header>
        <h1>Kelvin Tran</h1>
        <p>
        <img src="static/profile.jpg" style="width:140px;height:140px;border-radius: 10px;">
        </p>
        <p>I am a lawyer, but I do other things</p>
        <p class="view"><a href="http://github.com/kelvin-tran">GitHub</a> | <a href="http://twitter.com/_kelvintran">Twitter</a> | <a href="https://au.linkedin.com/in/kelvintran">LinkedIn</a></p>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
          <!-- Kelvin Tran GitHub pages index -->
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-8039812474190322"
               data-ad-slot="3954668498"
               data-ad-format="auto"></ins>
          <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </header>
      <section>
				<h1>Foreign workers in the USA</h1>
				<p><em>View the <a href="http://github.com/kelvin-tran/foreign-lawyers/">source of this content</a>.</em></p>
				<p>The rage in journalism these days seems to be to use data.  I'm thinking FiveThirtyEight's <a href="http://fivethirtyeight.com/datalab/">DataLab</a> and the Guardian's <a href="http://www.theguardian.com/data">Datablog</a>, but even the New York Times is including more and more data visualisations in its online <a href="http://www.nytimes.com/interactive/2015/04/20/upshot/missing-black-men.html?abt=0002&abg=1&_r=3">pieces</a>.</p>
				<p>By contrast, lawyers seem to care very little about data, maybe apart from the world of <a href="http://www.justice.gov/atr/public/guidelines/hhi.html">competition/antitrust</a> and the sentencing of criminals.  But eventually, the evidential value of data, because the proit is often so compelling.
				<p>Anyway, lawyers should care about dataThe US agency responsible for managing working visas for foreigners in the US publishes annual data about the applications it receives.  The data reveals, for each application, the employer, the job title, location of work and the employee's salary, amongst other things.  This is what the data looks like (in csv format):</p>
				<pre><code>LCA_CASE_NUMBER,STATUS,LCA_CASE_SUBMIT,DECISION_DATE,VISA_CLASS,LCA_CASE_EMPLOYMENT_START_DATE,LCA_CASE_EMPLOYMENT_END_DATE,LCA_CASE_EMPLOYER_NAME,LCA_CASE_EMPLOYER_ADDRESS,LCA_CASE_EMPLOYER_CITY,LCA_CASE_EMPLOYER_STATE,LCA_CASE_EMPLOYER_POSTAL_CODE,LCA_CASE_SOC_CODE,LCA_CASE_SOC_NAME,LCA_CASE_JOB_TITLE,LCA_CASE_WAGE_RATE_FROM,LCA_CASE_WAGE_RATE_TO,LCA_CASE_WAGE_RATE_UNIT,FULL_TIME_POS,TOTAL_WORKERS,LCA_CASE_WORKLOC1_CITY,LCA_CASE_WORKLOC1_STATE,PW_1,W_UNIT_1, PW_SOURCE_1,OTHER_WAGE_SOURCE_1,YR_SOURCE_PUB_1,LCA_CASE_WORKLOC2_CITY,LCA_CASE_WORKLOC2_STATE,PW_2,PW_UNIT_2,PW_SOURCE_2,OTHER_WAGE_SOURCE_2,YR_SOURCE_PUB_2,LCA_CASE_NAICS_CODE
		I-203-14042-820159,CERTIFIED,11/02/2014,18/02/2014,E-3 Australian,1/04/2014,31/03/2016,"ACUMATICA INC 4030 LAKE WASHINGTON BLVD KIRKLAND WA 98033",11-2021,Marketing Managers,VICE PRESIDENT - PARTNER STRATEGY,300000,,Year,Y,1,KIRKLAND,WA,134597.00,Year,OES,OFLC ONLINE DATA CENTER,2013,,,,,,,,511210,</code></pre>
				<p>You can search the data <a href="http://data.jobsintech.io/">here</a>, but what about the bigger picture?  As a lawyer, I'm always happy to find quicker ways to do repetitive tasks, especially when it might involve manually processing 510,000 plus rows of data.  Thankfully, an ability to code (JavaScript and D3.js) and some competence in MS Excel (pivot tables) allows me to analyse the data and create visualisations without too much effort.</p>
				<p>For example, we can group wages earned by foreign lawyers employed on a full-time basis and plot a frequency distribution (see Figure 1).</p>
				<div id='all-lawyer-wages'></div>
				<p><em>Figure 1.  Foreign lawyers seem to be doing alright for themselves.</em></p>
				<p>Because Australians are entitled to a separate visa class, the E-3, and because I'm Australian, we can also look at salaries earned by Australians working on the E-3 on a full-time basis (see Figure 2).</p>
				<div id='aus-wages'></div>
				<p><em>Figure 2.  Ok, these guys are killing it - how do I get an E-3 visa?.</em></p>
				<p>Finally, where are Australians working.  I suspect New York and California are up there, but what about the other states?  To sort this out, we can map the number of workers in each state to a colour scale, with darker colours for states with more workers and lighter colours for those with fewer (and gray for those anti-Australian states with none).  The result is a chloropleth map in Figure 3.</p>
				<div id='map'></div>
				<p><em>Figure 3.  What's going on in Washington and Texas?</em></p>
				<p>To find out about Washington (Figure 4) and Texas (Figure 5), we isolated the applications from employers in those states.</p>
				<div id="wash-chart"></div>
				<p><em>Figure 4.  Turns out its mainly tech employees (Amazon, Microsoft together employ about 250 Australians on E-3s in Washington.)</em></p>
				<div id="texas-chart"></div>
				<p><em>Figure 5.  And engineers in Texas - not surprising given the energy focus there.</em></p>
				<p>I hope you enjoyed reading - you can learn more about visualising data in D3.js <a href="http://d3js.org/">here</a>.</p>
      </section>
      <footer>
        <p>This page is maintained by <a href="http://github.com/kelvin-tran">Kelvin Tran</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
		<script>
			// lawyer wages graph
			var margin = {top: 20, right: 10, bottom: 80, left: 30},
					width = 620 - margin.left - margin.right,
					height = 350 - margin.top - margin.bottom;
			var x = d3.scale.ordinal()
					.rangeRoundBands([0, width], .2);
			var y = d3.scale.linear()
					.range([height, 0]);
			var xAxis = d3.svg.axis()
					.scale(x)
					.orient("bottom");
			var yAxis = d3.svg.axis()
					.scale(y)
					.orient("left");
			var svg = d3.select("#all-lawyer-wages").append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
				.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
			d3.csv("foreign-lawyers/lawyer-wages.csv", type, function(error, data) {
					if (error) throw error;
					x.domain(data.map(function(d) { return d.salary; }));
					y.domain([0, d3.max(data, function(d) { return d.count; })]);
					svg.append("g")
							.attr("class", "x axis")
							.attr("transform", "translate(0," + height + ")")
						.call(xAxis)
						.selectAll("text")  
							.style("text-anchor", "end")
							.attr("dx", "-.8em")
							.attr("dy", ".15em")
							.attr("transform", function(d) {
								return "rotate(-45)" 
							});
					svg.append("g")
							.attr("class", "y axis")
						.call(yAxis)
			    	.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", 6)
							.attr("dy", ".71em")
							.style("text-anchor", "end")
						.text("Number of foreign lawyers");
					svg.selectAll(".bar")
						.data(data)
						.enter().append("rect")
							.attr("class", "bar")
							.attr("x", function(d) { return x(d.salary); })
							.attr("width", x.rangeBand())
							.attr("y", function(d) { return y(d.count); })
							.attr("height", function(d) { return height - y(d.count); });
			});
			function type(d) {
				d.salary = '$' + d.salary.replace('000-', '-').replace(new RegExp('000$'), 'k');
				d.count = +d.count;
				return d;
			}
		</script>
		<script>
			// australian wages
			var aus_margin = {top: 20, right: 10, bottom: 80, left: 30},
			    aus_width = 620 - aus_margin.left - aus_margin.right,
			    aus_height = 350 - aus_margin.top - aus_margin.bottom;
			var aus_x = d3.scale.ordinal()
			    .rangeRoundBands([0, aus_width], .2);
			var aus_y = d3.scale.linear()
			    .range([aus_height, 0]);
			var aus_xAxis = d3.svg.axis()
			    .scale(aus_x)
			    .orient("bottom");
			var aus_yAxis = d3.svg.axis()
			    .scale(aus_y)
			    .orient("left");
			var aus_svg = d3.select("#aus-wages").append("svg")
			    .attr("width", aus_width + aus_margin.left + aus_margin.right)
			    .attr("height", aus_height + aus_margin.top + aus_margin.bottom)
			  .append("g")
			    .attr("transform", "translate(" + aus_margin.left + "," + aus_margin.top + ")");
			d3.csv("foreign-lawyers/aus-wages.csv", type, function(error, data) {
			  if (error) throw error;
			  aus_x.domain(data.map(function(d) { return d.salary; }));
			  aus_y.domain([0, d3.max(data, function(d) { return d.count; })]);
			  aus_svg.append("g")
						.attr("class", "x axis")
						.attr("transform", "translate(0," + aus_height + ")")
						.call(aus_xAxis)
						.selectAll("text")  
						.style("text-anchor", "end")
						.attr("dx", "-.8em")
						.attr("dy", ".15em")
						.attr("transform", function(d) {
							return "rotate(-55)" 
						});
			  aus_svg.append("g")
						.attr("class", "y axis")
						.call(aus_yAxis)
			    .append("text")
						.attr("transform", "rotate(-90)")
						.attr("y", 6)
						.attr("dy", ".71em")
						.style("text-anchor", "end")
						.text("Number of Aus workers");
			  aus_svg.selectAll(".bar")
						.data(data)
			    .enter().append("rect")
						.attr("class", "bar")
						.attr("x", function(d) { return aus_x(d.salary); })
						.attr("width", aus_x.rangeBand())
						.attr("y", function(d) { return aus_y(d.count); })
						.attr("height", function(d) { return height - aus_y(d.count); });
			});
			function type(d) {
			  d.salary = '$' + d.salary.replace('000-', '-').replace(new RegExp('000$'), 'k');
			  d.count = +d.count;
			  return d;
			}
		</script>
		<script>
			//Width and height
			var chloro_w = 600;
			var chloro_h = 380;
			//Define map projection
			var chloro_projection = d3.geo.albersUsa()
				.translate([chloro_w/2, chloro_h/2])
				.scale([600]);
			//Define path generator
			var chloro_path = d3.geo.path()
				.projection(chloro_projection);
							 
			//Define scale to sort data values into buckets of color
			var chloro_color = d3.scale.pow().exponent(.9)
				.range(['rgb(247,251,255)','rgb(222,235,247)','rgb(198,219,239)','rgb(158,202,225)','rgb(107,174,214)','rgb(66,146,198)','rgb(33,113,181)','rgb(8,81,156)','rgb(8,48,107)']);
			//Create SVG element
			var chloro_svg = d3.select("#map")
				.append("svg")
				.attr("width", chloro_w)
				.attr("height", chloro_h);
			//Load in agriculture data
			d3.csv("foreign-lawyers/aus-states.csv", function(data) {
				//Set input domain for color scale
				chloro_color.domain([
					d3.min(data, function(d) { return d.value; }), 
					d3.max(data, function(d) { return d.value; })
				]);
				//Load in GeoJSON data
				d3.json("foreign-lawyers/us-states.json", function(json) {
					//Merge the ag. data and GeoJSON
					//Loop through once for each ag. data value
					for (var i = 0; i < data.length; i++) {
						//Grab state name
						var dataState = data[i].state;
						//Grab data value, and convert from string to float
						var dataValue = parseFloat(data[i].value);
						//Find the corresponding state inside the GeoJSON
						for (var j = 0; j < json.features.length; j++) {
							var jsonState = json.features[j].properties.name;
							if (dataState == jsonState) {
								//Copy the data value into the JSON
								json.features[j].properties.value = dataValue;
								//Stop looking through the JSON
								break;
							}
						}		
					}
					//Bind data and create one path per GeoJSON feature
					chloro_svg.selectAll("path")
							.data(json.features)
							.enter()
							.append("path")
								.attr("d", chloro_path)
								.style("fill", function(d) {
									//Get data value
									var value = d.properties.value;
									if (value) {
									  //If value exists…
									  return chloro_color(value);
									} else {
									  //If value is undefined…
									  return "#ccc";
									}
								});
				});
			});
		</script>
		<script>
		var tx_margin = {right: 10, bottom: 30, left: 250},
				tx_width = 500 - tx_margin.left - tx_margin.right,
				tx_barHeight = 20;
		var tx_x = d3.scale.linear()
				.range([0, tx_width]);
		var tx_xAxis = d3.svg.axis()
				.scale(tx_x)
				.orient("bottom");
		d3.csv("foreign-lawyers/TX.csv", type, function(error, data) {
			var tx_height = tx_barHeight * data.length + tx_margin.bottom;
			var tx_chart = d3.select("#texas-chart").append("svg")
					.attr("class", "chart")
					.attr("width", tx_width + tx_margin.left + tx_margin.right)
					.attr("height", tx_height)
				.append("g")
					.attr("transform", "translate(" + tx_margin.left + ",0)");
			var tx_y = d3.scale.ordinal()
					.domain(data.map(function(d) { return d.profession; }))
					.rangeBands([0, tx_barHeight * data.length]);
			var tx_yAxis = d3.svg.axis()
					.scale(tx_y)
					.orient("left");
		  tx_x.domain([0, d3.max(data, function(d) { return d.value; })]);
			tx_chart.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + (tx_height - tx_margin.bottom) + ")")
				.call(tx_xAxis)
			tx_chart.append("g")
					.attr("class", "y axis")
				.call(tx_yAxis)
		  var tx_bar = tx_chart.selectAll("rect")
					.data(data)
				.enter().append("g")
					.attr("transform", function(d, i) { return "translate(0," + i * tx_barHeight + ")"; });
			tx_bar.append("rect")
					.attr("width", function(d) { return tx_x(d.value); })
					.attr("height", tx_barHeight - 1);
		});
		function type(d) {
			if (d.value > 15) {
			d.value = +d.value; // coerce to number
			return d;
			}
		};
		</script>
		<script>
		var wa_margin = {right: 10, bottom: 30, left: 250},
				wa_width = 500 - wa_margin.left - wa_margin.right,
				wa_barHeight = 20;
		var wa_x = d3.scale.linear()
				.range([0, wa_width]);
		var wa_xAxis = d3.svg.axis()
				.scale(wa_x)
				.orient("bottom");
		d3.csv("foreign-lawyers/WA.csv", type, function(error, data) {
			var wa_height = wa_barHeight * data.length + wa_margin.bottom;
			var wa_chart = d3.select("#wash-chart").append("svg")
					.attr("class", "chart")
					.attr("width", wa_width + wa_margin.left + wa_margin.right)
					.attr("height", wa_height)
				.append("g")
					.attr("transform", "translate(" + wa_margin.left + ",0)");
			var wa_y = d3.scale.ordinal()
					.domain(data.map(function(d) { return d.profession; }))
					.rangeBands([0, wa_barHeight * data.length]);
			var wa_yAxis = d3.svg.axis()
					.scale(wa_y)
					.orient("left");
		  wa_x.domain([0, d3.max(data, function(d) { return d.value; })]);
			wa_chart.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + (wa_height - wa_margin.bottom) + ")")
				.call(wa_xAxis)
			wa_chart.append("g")
					.attr("class", "y axis")
				.call(wa_yAxis)
		  var wa_bar = wa_chart.selectAll("rect")
					.data(data)
				.enter().append("g")
					.attr("transform", function(d, i) { return "translate(0," + i * wa_barHeight + ")"; });
			wa_bar.append("rect")
					.attr("width", function(d) { return wa_x(d.value); })
					.attr("height", wa_barHeight - 1);
		});
		function type(d) {
			if (d.value > 10) {
			d.value = +d.value; // coerce to number
			return d;
			}
		};
		</script>
	</body>
</html>
